{
    "Parameters": {
      "DeviceLocation": {
        "Type": "String"
      },
      "AWS::IoT::Certificate::Id": {
        "Type": "String"
      },
      "SerialNumber": {
        "Type": "String"
      }
    },
    "Mappings": {
      "LocationTable": {
        "Seattle": {
          "LocationUrl": "https://example.aws"
        }
      }
    },
    "Resources": {
      "thing": {
        "Type": "AWS::IoT::Thing",
        "Properties": {
          "ThingName": {
            "Fn::Join": [
              "",
              [
                "ThingPrefix_",
                {
                  "Ref": "SerialNumber"
                }
              ]
            ]
          },
          "AttributePayload": {
            "version": "v1",
            "serialNumber": "serialNumber"
          }
        },
        "OverrideSettings": {
          "AttributePayload": "MERGE",
          "ThingTypeName": "REPLACE",
          "ThingGroups": "DO_NOTHING"
        }
      },
      "certificate": {
        "Type": "AWS::IoT::Certificate",
        "Properties": {
          "CertificateId": {
            "Ref": "AWS::IoT::Certificate::Id"
          },
          "Status": "Active"
        },
        "OverrideSettings": {
          "Status": "REPLACE"
        }
      },
      "policy": {
        "Type": "AWS::IoT::Policy",
        "Properties": {
          "PolicyDocument": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Action": [
                  "iot:Connect",
                  "iot:Subscribe",
                  "iot:Publish",
                  "iot:Receive"
                ],
                "Resource": "*"
              }
            ]
          }
        }
      }
    },
    "DeviceConfiguration": {
      "FallbackUrl": "https://www.example.com/test-site",
      "LocationUrl": {
        "Fn::FindInMap": [
          "LocationTable",
          {
            "Ref": "DeviceLocation"
          },
          "LocationUrl"
        ]
      }
    }
  }